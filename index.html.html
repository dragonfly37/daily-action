<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Action Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root { --min-bg: #f8f9fa; --more-bg: #fff9f0; --max-bg: #fff0f5; --accent: #333; }
        body { font-family: 'Pretendard', sans-serif; background: #eef1f4; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .header { background: white; width: 100%; max-width: 900px; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center; }
        input[type="date"] { padding: 10px; border-radius: 8px; border: 1px solid #ddd; font-size: 1.1rem; width: 200px; cursor: pointer; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; width: 100%; max-width: 1000px; }
        .category-card { background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .category-title { font-size: 1.3rem; font-weight: 800; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid var(--accent); color: var(--accent); }
        .level-group { margin-bottom: 15px; border-radius: 10px; padding: 10px; }
        .level-min { background: var(--min-bg); }
        .level-more { background: var(--more-bg); }
        .level-max { background: var(--max-bg); }
        .level-label { font-weight: bold; font-size: 0.85rem; margin-bottom: 8px; display: block; color: #666; }
        .action-item { display: flex; align-items: flex-start; margin-bottom: 6px; }
        .action-item input { margin-top: 4px; margin-right: 10px; width: 18px; height: 18px; cursor: pointer; }
        .action-item label { font-size: 0.95rem; line-height: 1.4; color: #444; cursor: pointer; }
/* ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒ(checked)ë˜ë©´ ë°”ë¡œ ë’¤ì— ìˆëŠ” labelì˜ ìŠ¤íƒ€ì¼ì„ ë³€ê²½ */
.action-item input:checked + label {
    text-decoration: line-through; /* ì·¨ì†Œì„  */
    color: #bbb; /* íë¦° íšŒìƒ‰ */
    opacity: 0.7; /* íˆ¬ëª…ë„ ì¡°ì ˆ */
}
        #sync-status { position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.8); color: white; padding: 10px 25px; border-radius: 30px; display: none; z-index: 1000; font-weight: bold; }

/* ì§„í–‰ë¥  ë°”ì˜ ë°”ê¹¥ í…Œë‘ë¦¬ */
.progress-container {
    width: 100%;
    background-color: #eee;
    border-radius: 10px;
    margin-top: 10px;
    height: 10px;
    overflow: hidden;
}

/* ì‹¤ì œë¡œ ì°¨ì˜¤ë¥´ëŠ” ìƒ‰ìƒ ë§‰ëŒ€ */
.progress-bar {
    width: 0%; /* ì²˜ìŒì—” 0% */
    height: 100%;
    background-color: #4caf50; /* ì´ˆë¡ìƒ‰ */
    transition: width 0.3s ease; /* ë¶€ë“œëŸ½ê²Œ ì°¨ì˜¤ë¥´ëŠ” íš¨ê³¼ */
}



        @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="header">
    <h2 style="margin-top:0;">ğŸ“‹ Daily Action Dashboard</h2>
    <input type="date" id="dateSelect">
    <div id="counter" style="margin-top:15px; font-weight:bold; color: #555;">ì˜¤ëŠ˜ 0 / 72 ë‹¬ì„± ì¤‘!</div>
    
    <div class="progress-container">
        <div id="progressBar" class="progress-bar"></div>
    </div>
<div id="cheerMessage" style="margin-top:10px; font-size: 1.2rem; font-weight: bold; color: #ff5722; min-height: 1.5rem;"></div>
</div>

    <div class="grid" id="mainGrid">
        </div>

    <div id="sync-status">ì‹œíŠ¸ì— ì €ì¥ ì¤‘... ğŸš€</div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbytkuprz2BdLodp4EMhJQebKjqCbdL12OdH6WxDece22nXn9riWwFKKZgrCwNAmZaesQg/exec";

        // [ë°ì´í„° ë°°ì—´] ìˆ˜ì •í•˜ê³  ì‹¶ì€ í…ìŠ¤íŠ¸ê°€ ìˆë‹¤ë©´ ì—¬ê¸°ë§Œ ê³ ì¹˜ë©´ ë©ë‹ˆë‹¤!
        const data = [
            { cat: "ìš´ë™", items: { Min: ["í‘¸ì‹œì—… 5íšŒ", "ë²„í• 5íšŒ", "ìŠ¤ì¿¼íŠ¸ 5íšŒ"], More: ["í‘¸ì‹œì—… 15íšŒ", "ë²„í• 15íšŒ", "ìŠ¤ì¿¼íŠ¸ 15íšŒ"], Max: ["ìš´ë™ 1ì‹œê°„", "ë‹¬ë¦¬ê¸° 20ë¶„", "í¬ë¡œìŠ¤í• WOD 10ë¶„"] }},
            { cat: "ë³‘ë²•ì„œ", items: { Min: ["ë¯¸ë‹ˆë…¸íŠ¸ ì±™ê¸°ê¸°", "ë‚˜ìœ¤ì´ ë§ˆìŒí‘œí˜„ 3ë²ˆ", "íš¨ì§„ì´ ë§ˆìŒí‘œí˜„ 3ë²ˆ"], More: ["ë¯¸ë‹ˆë…¸íŠ¸ ì‘ì„±", "ë¯¸ë‹ˆë…¸íŠ¸ ë³µê¸°", "ë³‘ë²•ì„œ 10ë¶„ ë“£ê¸°"], Max: ["ë³‘ë²•ì„œ ë…¸íŠ¸ ë³µê¸°", "ê²½í—˜ ë…¸íŠ¸ 10ë¶„", "ë³‘ë²•ì„œ 30ë¶„ ë“£ê¸°"] }},
            { cat: "ì‚°ì—…", items: { Min: ["ì•„ì›ƒìŠ¤íƒ ë”© ì ‘ì†", "ë‰´ìŠ¤ë ˆí„° ëª¨ë‘ ì—´ì–´ë³´ê¸°", "ECO ì±„ë„ 1ê°œ ì—´ê¸°"], More: ["ì•„ì›ƒìŠ¤íƒ ë”© 2ê°œ", "ë‰´ìŠ¤ë ˆí„° 2ê°œ", "ê´‘ê³ ì†Œê°œì„œ 1ê°œ"], Max: ["ë¯¸ë””ì–´ë¦¬í¬íŠ¸ 2ê°œ", "ì„¼ì„œíƒ€ì›Œ ë¦¬í¬íŠ¸ 2ê°œ", "PL 2ê°œ"] }},
            { cat: "ëª°ë¡œì½”", items: { Min: ["ë§¤ì¶œ ì ê¸°", "ë©”ì¼ ì •ë¦¬ 1ë²ˆ", "ë§í¬ë“œì¸ ê¸€ 1ê°œ"], More: ["íŒ€ ìœ„í´ë¦¬ 1ê°œ ì½ê¸°", "íšŒì‚¬ ì œí’ˆ ì—…ë°ì´íŠ¸ 10ë¶„", "AI ì±„íŒ… 10ë¶„"], Max: ["ë¦¬ë” ê¸€ 2ê°œ", "ìƒˆë¡œìš´ ì‚¬ëŒ ì¸ì‚¬ 1ë²ˆ", "PL 2ê°œ"] }},
            { cat: "AI/ì½”ë”©", items: { Min: ["AI ì˜ìƒ 1ê°œ ì‹œì²­", "ì¸í”„ëŸ° í˜ì´ì§€ ì ‘ì†", "AI íƒ€ì„ìŠ¤ ê¸°ì‚¬ 1ê°œ"], More: ["ì‹¤ë¦¬ì½˜ë°¸ë¦¬ ë¯¸ë“œ 1ê°œ", "íšŒì‚¬ ML ì—…ë°ì´íŠ¸ 10ë¶„", "ì½”ë”© ê°•ì˜ 20ë¶„"], Max: ["ê´€ë ¨ ì±… ë…ì„œ 10ë¶„", "í—ˆì§„í˜¸/AI 1ê°œ", "ì½”ë”© ì‹¤ì „ 20ë¶„"] }},
            { cat: "ì˜ì–´", items: { Min: ["ìº˜ë¦¬ ë‹¨ì–´ 1+1", "ë¹„ì¦ˆë‹ˆìŠ¤ ë¬¸ì¥ 1ê°œ ì™¸ìš°ê¸°", "ë‚˜ìœ¤ ë™í™” í•œí¸ ì½ì–´ì£¼ê¸°"], More: ["V-log ë£¨í‹´ 1ë¬¸ë‹¨ ì™¸ìš°ê¸°", "WOD ì´ 60ë¶„", "ì˜ì–´ìë§‰ ì½˜í…ì¸  1í¸ ë³´ê¸°"], Max: ["Ad-week 10ë¶„ ì„œí•‘", "WOD ì´ 90ë¶„", "ì „í™”ì˜ì–´ 20ë¶„"] }},
            { cat: "íˆ¬ì", items: { Min: ["ë§¤ì¼ ì‹ ë¬¸ 1ë©´ ì½ê¸°", "ë²„í• ì±… í•œí˜ì´ì§€ ì½ê¸°", "ì˜ì–´ ë‰´ìŠ¤ë ˆí„° ì—´ì–´ë³´ê¸°"], More: ["í…”ë ˆ) ì¸í„°ë„·/ê²Œì„ ê¸€ 5ê°œ", "í…”ë ˆ) ë¼í”¼í‚¤ ê¸€ 5ê°œ", "í…”ë ˆ) ì´ì›…ì°¬ ê¸€ 5ê°œ"], Max: ["ì‹ ë¬¸ ì™„ë…í•˜ê¸°", "ë””ìŠ¤ì´ì¦ˆ ê²Œì„ ê¸°ì‚¬ 3ê°œ", "AI ì±„íŒ… 10ë¶„"] }},
            { cat: "ìŠµê´€", items: { Min: ["ì¬í¬ë¦¼ ë°”ë¥´ê¸°", "íƒ„ì‚°ìŒë£Œ í•˜ë£¨ 1ê°œë§Œ", "ì•½ ì±™ê²¨ë¨¹ê¸°"], More: ["ê³¼ì ë¨¹ì§€ ì•Šê¸°", "ë°¥ í•œìˆŸê°€ë½ ëœ ë¨¹ê¸°", "ëª¸ë¬´ê²Œ ì¸¡ì •í•˜ê¸°"], Max: ["9ì‹œ ì´í›„ ê¸ˆì‹", "ìƒëŸ¬ë“œ 1ë¼", "ì¸ì‚¬ ë¨¼ì € í•˜ê¸°"] }}
        ];

        const dateInput = document.getElementById('dateSelect');
        const mainGrid = document.getElementById('mainGrid');
        const syncStatus = document.getElementById('sync-status');

        // ì´ˆê¸° ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
        dateInput.value = new Date().toISOString().split('T')[0];

        // [í™”ë©´ ê·¸ë¦¬ê¸° í•¨ìˆ˜] ë‚ ì§œê°€ ë°”ë€Œê±°ë‚˜ ì²˜ìŒ ì ‘ì† ì‹œ ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒˆë¡œ ë§Œë“­ë‹ˆë‹¤.
// render í•¨ìˆ˜ë¥¼ ë¹„ë™ê¸°(async) í•¨ìˆ˜ë¡œ ë³€ê²½í•˜ì—¬ ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¬ê²Œ ë§Œë“­ë‹ˆë‹¤.
async function render() {
    const selectedDate = dateInput.value;
    mainGrid.innerHTML = '<p style="text-align:center;">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
    
    // 1. êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ í•´ë‹¹ ë‚ ì§œì— ì™„ë£Œëœ í•­ëª© ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
    let completedItems = [];
    try {
        const response = await fetch(`${SCRIPT_URL}?date=${selectedDate}`);
        completedItems = await response.json();
    } catch (e) {
        console.error("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:", e);
    }

    mainGrid.innerHTML = ''; 
    data.forEach(category => {
        const card = document.createElement('div');
        card.className = 'category-card';
        let cardHTML = `<div class="category-title">${category.cat}</div>`;
        
        ["Min", "More", "Max"].forEach(level => {
            cardHTML += `<div class="level-group level-${level.toLowerCase()}">
                <span class="level-label">${level}</span>`;
            category.items[level].forEach((item, idx) => {
                const itemId = `${category.cat}-${level}-${idx}`;
                // ê°€ì ¸ì˜¨ ë°ì´í„°ì— ì´ í•­ëª©ì´ ìˆìœ¼ë©´ ì²´í¬(checked) ìƒíƒœë¡œ ë§Œë“­ë‹ˆë‹¤.
                const isChecked = completedItems.includes(item) ? 'checked' : '';
                
                cardHTML += `
                    <div class="action-item">
                        <input type="checkbox" id="${itemId}" ${isChecked} onchange="sync('${category.cat}', '${level}', '${item}', this.checked)">
                        <label for="${itemId}">${item}</label>
                    </div>`;
            });
            cardHTML += `</div>`;
        });
        card.innerHTML = cardHTML;
        mainGrid.appendChild(card);
    });
    
    updateCounter(); // ì²´í¬ë°•ìŠ¤ê°€ ì±„ì›Œì§„ í›„ ì¹´ìš´í„°ì™€ ì§„í–‰ë°” ì—…ë°ì´íŠ¸
}

function updateCounter() {
    const total = document.querySelectorAll('input[type="checkbox"]').length;
    const checked = document.querySelectorAll('input[type="checkbox"]:checked').length;
    const cheerMsg = document.getElementById('cheerMessage');
    
    // 1. ìˆ«ì ë° ì§„í–‰ë°” ì—…ë°ì´íŠ¸
    document.getElementById('counter').innerText = `ì˜¤ëŠ˜ ${checked} / ${total} ë‹¬ì„± ì¤‘!`;
    const percentage = total > 0 ? (checked / total) * 100 : 0;
    document.getElementById('progressBar').style.width = percentage + '%';

    // 2. ë©”ì‹œì§€ ì´ˆê¸°í™”
    cheerMsg.innerText = "";

    // 3. [í­ì£½ ë° ë©”ì‹œì§€ ë¡œì§]
    if (checked > 0) {
        if (checked === total) {
            // 100% ë‹¬ì„±: í”¼ë‚ ë ˆ
            cheerMsg.innerText = "ğŸ‰ ì™„ë²½í•©ë‹ˆë‹¤! ì˜¤ëŠ˜ ëª©í‘œ 100% ë‹¬ì„±!";
            fireFinalConfetti();
        } else if (checked === 36) {
            // ì ˆë°˜ ì§€ì  (36ê°œ): ì‘ì› ë©”ì‹œì§€ + ë” í™”ë ¤í•œ í­ì£½
            cheerMsg.innerText = "ğŸ”¥ ì ˆë°˜ì´ë‚˜ ì™”ì–´! ì¡°ê¸ˆë§Œ ë” í˜ë‚´ìš”!";
            fireSpecialConfetti(); 
        } else if (checked % 10 === 0) {
            // 10ë‹¨ìœ„: ì¼ë°˜ í­ì£½ë³´ë‹¤ ë” í¬ê²Œ ê°œì„ 
            fireStepConfetti();
        }
    }
}

// [10ê°œ ë‹¨ìœ„] ê¸°ì¡´ë³´ë‹¤ ì–‘ì„ 2ë°° ëŠ˜ë¦¬ê³  ë²”ìœ„ë¥¼ ë„“í˜
function fireStepConfetti() {
    confetti({
        particleCount: 100, // ì–‘ì„ ëŠ˜ë¦¼
        spread: 100,        // ë” ë„“ê²Œ í¼ì§
        origin: { y: 0.6 },
        scale: 1.2          // ì…ì í¬ê¸° í‚¤ì›€
    });
}

// [36ê°œ ì ˆë°˜ ì§€ì ] ë” í™”ë ¤í•œ ìŠ¤íƒ€ì¼ (ì¤‘ì•™ ì•„ë˜ì—ì„œ ìœ„ë¡œ ì†Ÿêµ¬ì¹¨)
function fireSpecialConfetti() {
    var count = 200;
    var defaults = { origin: { y: 0.7 } };

    function fire(particleRatio, opts) {
        confetti(Object.assign({}, defaults, opts, {
            particleCount: Math.floor(count * particleRatio)
        }));
    }

    fire(0.25, { spread: 26, startVelocity: 55 });
    fire(0.2, { spread: 60 });
    fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
    fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
    fire(0.1, { spread: 120, startVelocity: 45 });
}

// [100% í”¼ë‚ ë ˆ] 3ì´ˆê°„ í™”ë ¤í•˜ê²Œ ì§€ì† (ì´ë¯¸ êµ¬í˜„ëœ ë¡œì§ ìœ ì§€/ê°•í™”)
function fireFinalConfetti() {
    const duration = 4 * 1000; // 4ì´ˆë¡œ ì—°ì¥
    const end = Date.now() + duration;

    (function frame() {
        confetti({
            particleCount: 7,
            angle: 60,
            spread: 55,
            origin: { x: 0, y: 0.6 },
            colors: ['#ff0000', '#ffa500', '#ffeb3b', '#ffffff']
        });
        confetti({
            particleCount: 7,
            angle: 120,
            spread: 55,
            origin: { x: 1, y: 0.6 },
            colors: ['#ff0000', '#ffa500', '#ffeb3b', '#ffffff']
        });

        if (Date.now() < end) {
            requestAnimationFrame(frame);
        }
    }());
}


        // [ì„œë²„ ì „ì†¡ í•¨ìˆ˜] ì²´í¬ë¥¼ í•˜ê±°ë‚˜ í•´ì œí•  ë•Œ êµ¬ê¸€ ì‹œíŠ¸ë¡œ ë³´ëƒ…ë‹ˆë‹¤.
        async function sync(category, level, itemName, isChecked) {
            updateCounter(); // ì²´í¬í•  ë•Œë§ˆë‹¤ ìˆ«ìë¥¼ ë‹¤ì‹œ ì…‰ë‹ˆë‹¤.
 	    syncStatus.style.display = 'block';
            try {
                await fetch(SCRIPT_URL, {
                    method: "POST",
                    body: JSON.stringify({
                        date: dateInput.value,
                        category: `${category}(${level})`,
                        workout: itemName,
                        isChecked: isChecked
                    })
                });
            } catch (e) { console.error("ì „ì†¡ ì˜¤ë¥˜:", e); }
            syncStatus.style.display = 'none';
        }

        // ë‚ ì§œ ë³€ê²½ ì´ë²¤íŠ¸ ì—°ê²°
        dateInput.addEventListener('change', render);

        // ì²« ì‹¤í–‰
        render();
    </script>
</body>
</html>